# Tornado Rsyslog Collector (executable)

The rsyslog Collector binary is an executable that generates Tornado Events from
rsyslog inputs.



## How It Works

This Collector is meant to be integrated with rsyslogâ€™s own logging through the
[omprog module](https://www.rsyslog.com/doc/v8-stable/configuration/modules/omprog.html).
Consequently, it is never started manually, but instead will be started, and managed,
directly by rsyslog itself.

Here is an example rsyslog configuration template that pipes logs to the rsyslog-collector
(the parameters are explained below):
```
module(load="omprog")

action(type="omprog"
       binary="/path/to/tornado_rsyslog_collector --some-collector-options")
```

An example of a fully instantiated startup setup is:
```
module(load="omprog")

action(type="omprog"
       binary="/path/to/rsyslog_collector --config-dir=/tornado-rsyslog-collector/config --tornado-event-socket-ip=tornado_server_ip --tornado-event-socket-port=4747")
```

<!-- This part may only be necessary for non-expert users. Hide until later? -->
Note that all parameters for the _binary_ option must be on the same line. You will need to
place this configuration in a file in your rsyslog directory, for instance:
```
/etc/rsyslog.d/tornado.conf
```

In this example the collector will:
- Reads the configuration from the _/tornado-rsyslog-collector/config_ directory
- Write outgoing Events to the TCP socket at tornado_server_ip:4747

The Collector will need to be run in parallel with the Tornado engine before any events will be
processed, for example:  <!-- Link to the description of that executable -->
```
/opt/tornado/bin/tornado --tornado-event-socket-ip=tornado_server_ip
```

Under this configuration, rsyslog is in charge of starting the collector when needed and piping
the incoming logs to it. As the last stage, the Tornado Events generated by the collector are
forwarded to the Tornado Engine's TCP socket.

This integration strategy is the best option for supporting high performance given massive
amounts of log data.

Because the collector expects the input to be in JSON format, **rsyslog should be pre-configured**
to properly pipe its inputs in this form.



## Configuration Options

The executable configuration is based partially on configuration files, and partially on command
line parameters.

The available startup parameters are:
- __config-dir__:  The filesystem folder from which the collector configuration is read.
  The default path is _/etc/tornado_rsyslog_collector/_.

In addition to these parameters, the following configuration entries are available in the 
file _'config-dir'/rsyslog_collector.toml_:
- __logger__:
    - __level__:  The Logger level; valid values are _trace_, _debug_, _info_, _warn_, and
      _error_.
    - __stdout__:  Determines whether the Logger should print to standard output.
      Valid values are `true` and `false`.
    - **file_output_path**:  A file path in the file system; if provided, the Logger will
      append any output to it.
- **rsyslog_collector**:
    - **tornado_event_socket_ip**:  The IP address where outgoing events will be written.
      This should be the address where the Tornado Engine listens for incoming events.
    - **tornado_event_socket_port**:  The port where outgoing events will be written.
      This should be the port where the Tornado Engine listens for incoming events.
    - **message_queue_size**:  The in-memory buffer size for Events. It makes the application
      resilient to Tornado Engine crashes or temporary unavailability.
      When Tornado restarts, all messages in the buffer will be sent.
      When the buffer is full, the collector will start discarding older messages first.

More information about the logger configuration is available
[here](../../../common/logger/doc/README.md).

The default __config-dir__ value can be customized at build time by specifying
the environment variable *TORNADO_RSYSLOG_COLLECTOR_CONFIG_DIR_DEFAULT*. 
For example, this will build an executable that uses */my/custom/path* 
as the default value:
```bash
TORNADO_RSYSLOG_COLLECTOR_CONFIG_DIR_DEFAULT=/my/custom/path cargo build 
```